<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" crossorigin="anonymous" />
    <title>Share Flex Message</title>
  </head>
  <body>
    <center>
      <p>... กำลังโหลด ...</p>
      <img src="https://image.makewebeasy.net/makeweb/0/pMrtkmxgt/APNG_images/loader1_1.gif?v=202012190947" alt="loading" width="126" height="129" />
      <p>กรุณารอสักครู่</p>
    </center>

    <script>
      window.onload = function() {
        liff.init({ liffId: "2006828731-be5MzK2R" })
          .then(() => {
            if (liff.isLoggedIn()) {
              dolink();
            } else {
              liff.login();
            }
          })
          .catch(err => console.error('LIFF Initialization failed ', err));
      };


      function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
        const results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
      }

      async function fetchDataFromGoogleSheet(id) {
        const url = `https://script.google.com/macros/s/AKfycbzMSZJfba4TmQngte9ALnNxBhkS5dVoWFRca-EnwA61vqMUaRz3NReCJUCDJxhpYc0Q/exec?id=${id}`;
        const response = await fetch(url);
        const data = await response.json();
        return data;
      }

      function dolink() {
        const referId = getParameterByName("id");

        fetchDataFromGoogleSheet(referId).then(data => {
          if (data.error) {
            Swal.fire('Error', 'ไม่พบข้อมูลที่ต้องการ', 'error');
            return;
          }

          if (referId === getParameterByName("id")) {
            liff.shareTargetPicker([
              {
                "type": "flex",
                "altText": "นพค.45 สนภ.4 นทพ.",
                "contents": 
// -------ใส่ JSON ----------

{
  "type": "bubble",
  "size": "giga",
  "header": {
    "type": "box",
    "layout": "vertical",
    "contents": [
      {
        "type": "image",
        "url": "https://img2.pic.in.th/pic/-45c6b1ca61a92f91ac.jpg",
        "size": "full",
        "aspectRatio": "1400:200",
        "align": "center",
        "gravity": "center",
        "aspectMode": "cover",
        "offsetTop": "none",
        "animated": true
      }
    ],
    "paddingAll": "none"
  },
  "hero": {
    "type": "box",
    "layout": "vertical",
    "contents": [
      {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "box",
            "layout": "vertical",
            "contents": [
              {
                "type": "box",
                "layout": "horizontal",
                "contents": [
                  {
                    "type": "image",
                    "size": "full",
                    "aspectRatio": "16:10",
                    "url": data.imagetitle,
                    "aspectMode": "cover",
                    "action": {
                      "type": "uri",
                      "label": "action",
                      "uri": data.imagetitle
                    }
                  }
                ],
                "width": "100%",
                "cornerRadius": "xl"
              },
              {
                "type": "box",
                "layout": "vertical",
                "contents": [
                  {
                    "type": "text",
                    "size": "sm",
                    "weight": "bold",
                    "align": "start",
                    "wrap": true,
                    "contents": [
                      {
                        "type": "span",
                        "color": "#293377",
                        "decoration": "underline",
                        "size": "lg",
                        "text": data.title
                      }
                    ],
                    "margin": "lg",
                    "offsetStart": "sm",
                    "offsetEnd": "sm",
                    "offsetBottom": "md"
                  },
                  {
                    "type": "text",
                    "text": data.description,
                    "wrap": true
                  }
                ],
                "paddingAll": "md",
                "width": "100%"
              },
              {
                "type": "box",
                "layout": "horizontal",
                "contents": [
                  {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                      {
                        "type": "image",
                        "size": "full",
                        "aspectMode": "cover",
                        "align": "center",
                        "gravity": "center",
                        "aspectRatio": "16:9",
                        "url": data.image1,
                        "action": {
                          "type": "uri",
                          "label": "action",
                          "uri": data.image1
                        }
                      }
                    ],
                    "borderWidth": "none",
                    "width": "33%",
                    "cornerRadius": "sm",
                    "offsetEnd": "xs"
                  },
                  {
                    "type": "box",
                    "layout": "horizontal",
                    "contents": [
                      {
                        "type": "image",
                        "url": data.image2,
                        "size": "full",
                        "aspectMode": "cover",
                        "aspectRatio": "16:9",
                        "action": {
                          "type": "uri",
                          "label": "action",
                          "uri": data.image2
                        }
                      }
                    ],
                    "width": "33%",
                    "offsetEnd": "none",
                    "paddingEnd": "none",
                    "cornerRadius": "sm",
                    "offsetStart": "xs"
                  },
                  {
                    "type": "box",
                    "layout": "horizontal",
                    "contents": [
                      {
                        "type": "image",
                        "aspectMode": "cover",
                        "size": "full",
                        "aspectRatio": "16:9",
                        "url": data.image3,
                        "action": {
                          "type": "uri",
                          "label": "action",
                          "uri": data.image3
                        }
                      }
                    ],
                    "width": "33%",
                    "cornerRadius": "sm",
                    "offsetStart": "5px"
                  },
                  {
                    "type": "box",
                    "layout": "vertical",
                    "contents": []
                  }
                ],
                "borderWidth": "none",
                "alignItems": "flex-start",
                "paddingAll": "xs"
              }
            ]
          },
          {
            "type": "box",
            "layout": "horizontal",
            "contents": [
              {
                "type": "box",
                "layout": "baseline",
                "contents": [
                  {
                    "type": "icon",
                    "url": "https://static-00.iconduck.com/assets.00/facebook-icon-512x512-seb542ju.png",
                    "size": "4xl",
                    "margin": "none",
                    "offsetStart": "xxl",
                    "offsetEnd": "none",
                    "offsetBottom": "none",
                    "offsetTop": "xs"
                  }
                ],
                "borderWidth": "normal",
                "width": "33%",
                "action": {
                  "type": "uri",
                  "label": "FB",
                  "uri": data.fblink
                },
                "justifyContent": "center"
              },
              {
                "type": "box",
                "layout": "baseline",
                "contents": [
                  {
                    "type": "icon",
                    "url": "https://cdn-icons-png.flaticon.com/512/3938/3938074.png",
                    "size": "4xl",
                    "offsetTop": "xs"
                  }
                ],
                "width": "33%",
                "action": {
                  "type": "uri",
                  "label": "Tiktok",
                  "uri": data.tklink
                },
                "justifyContent": "center"
              },
              {
                "type": "box",
                "layout": "baseline",
                "contents": [
                  {
                    "type": "icon",
                    "url": "https://j5pr.rtarf.mi.th/FlexMsg/PRD/images/Flex-%E0%B8%A3%E0%B8%B2%E0%B8%A2%E0%B8%87%E0%B8%B2%E0%B8%99Influ/btsweb.png",
                    "size": "4xl",
                    "offsetTop": "xs",
                    "offsetEnd": "xl"
                  }
                ],
                "width": "33%",
                "action": {
                  "type": "uri",
                  "label": "Website",
                  "uri": data.weblink
                },
                "justifyContent": "center"
              }
            ],
            "paddingTop": "xs",
            "paddingEnd": "xs",
            "offsetTop": "xs"
          }
        ],
        "backgroundColor": "#ffffff",
        "borderWidth": "semi-bold",
        "borderColor": "#005a91",
        "cornerRadius": "xxl",
        "offsetTop": "md",
        "offsetBottom": "lg",
        "paddingAll": "md"
      }
    ],
    "paddingAll": "lg",
    "paddingBottom": "lg",
    "background": {
      "type": "linearGradient",
      "angle": "0deg",
      "startColor": "#E6E6FA",
      "endColor": "#005a91"
    },
    "backgroundColor": "#B22222"
  },
  "body": {
    "type": "box",
    "layout": "horizontal",
    "contents": [
      {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "image",
            "url": "https://j5pr.rtarf.mi.th/FlexMsg/PRD/images/Flex-PR%E0%B8%A3%E0%B8%B2%E0%B8%A2%E0%B8%A7%E0%B8%B1%E0%B8%99/%E0%B8%9D%E0%B8%B2%E0%B8%81%E0%B8%A3%E0%B8%B9%E0%B8%9B/Icon%20Flex%20Message%202024/share2.png",
            "size": "full",
            "aspectRatio": "10:2",
            "action": {
              "type": "uri",
              "label": "คลิกเพื่อแชร์",
              "uri": data.liffshare
            }
          }
        ]
      }
    ],
    "backgroundColor": "#E6E6FA",
    "offsetTop": "xs",
    "paddingTop": "1px",
    "paddingEnd": "lg",
    "paddingBottom": "5px"
  },
  "footer": {
    "type": "box",
    "layout": "vertical",
    "contents": [
      {
        "type": "image",
        "url": "https://img2.pic.in.th/pic/634b9dd044bd06dc8c4e69b837ac0f6e.png",
        "size": "full",
        "aspectRatio": "160:18",
        "aspectMode": "cover"
      }
    ],
    "paddingAll": "none"
  },
  "styles": {
    "hero": {
      "backgroundColor": "#B22222"
    },
    "body": {
      "backgroundColor": "#d6ebf5"
    },
    "footer": {
      "backgroundColor": "#ffffff"
    }
  }
}
                  

// -------จบ JSON ----------

              }
            ])
            .then(function() {
              Swal.fire({
                position: 'top-center',
                icon: 'success',
                title: 'ส่งข้อมูลเรียบร้อย',
                showConfirmButton: false,
                timer: 1500,
                onClose: () => {
                  liff.closeWindow();
                }
              });
            })
            .catch(function(error) {
              console.error("Error in shareTargetPicker: ", error);
            });
          }
        }).catch(error => {
          console.error("Error fetching data: ", error);
          Swal.fire('Error', 'เกิดข้อผิดพลาดในการดึงข้อมูล', 'error');
        });
      }


    </script>

    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  </body>
</html>
